<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        
        /* Fixed height container for the Diagram with a scrollbar */
        #scroll-box {
            height: 400px; 
            overflow-y: auto; 
            border: 2px solid #666;
            background-color: white;
            padding: 10px;
            border-radius: 4px;
        }

        /* Ensure the SVG maintains its internal proportions */
        #diagram-container svg { 
            width: 100%; 
            height: auto; 
            display: block;
        }

        #controls { margin: 15px 0; }
        
        #display-frame {
            width: 100%;
            height: 500px;
            border: 2px solid #333;
            background-color: white;
        }

        button {
            padding: 8px 15px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background-color: #c0392b; }
    </style>
</head>
<body>

    <h2>Project Architecture</h2>
    
    <div id="scroll-box">
        <div id="diagram-container">Loading diagram...</div>
    </div>

    <div id="controls">
        <button onclick="resetIframe()">Clear Preview</button>
    </div>

    <iframe name="my_display_frame" id="display-frame" src="about:blank"></iframe>

    

    <script src="https://unpkg.com/plantuml-encoder/dist/plantuml-encoder.min.js"></script>
    <script>
        // resetIframe function
        function resetIframe() {
            document.getElementById('display-frame').src = "about:blank";
        }

        // Expanded PUML code to demonstrate scrolling
        const pumlCode = `@startuml
        skinparam svgLinkTarget my_display_frame
        
        participant "FFmpeg Generator" as Gen
        participant "MediaMTX" as MTX
        participant "FFplay Reader" as Read

        Gen -> MTX : [[https://en.m.wikipedia.org/wiki/Real-Time_Streaming_Protocol Push RTSP Stream]]
        activate MTX
        MTX -> MTX : Buffer stream
        MTX -> Read : [[https://en.m.wikipedia.org/wiki/FFmpeg Deliver to Client]]
        deactivate MTX
        
        note over Gen, Read : Below are extra steps to force vertical length
        
        Gen -> MTX : Health Check
        Gen -> MTX : Send Metadata
        Gen -> MTX : Stream Data
        MTX -> Read : Relay Data
        
        Gen -> MTX : Health Check
        Gen -> MTX : Send Metadata
        Gen -> MTX : Stream Data
        MTX -> Read : Relay Data
        
        Gen -> MTX : Health Check
        Gen -> MTX : Send Metadata
        Gen -> MTX : Stream Data
        MTX -> Read : Relay Data

        @enduml`;

        const encoded = plantumlEncoder.encode(pumlCode);
        const svgUrl = 'https://www.plantuml.com/plantuml/svg/' + encoded;

        fetch(svgUrl)
            .then(response => response.text())
            .then(svgText => {
                document.getElementById('diagram-container').innerHTML = svgText;
            })
            .catch(err => {
                document.getElementById('diagram-container').innerText = "Failed to load diagram.";
            });
    </script>
</body>
</html>
